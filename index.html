            showScreen('background');
        }

        function goBack() {
            const screens = ['welcome', 'background', 'people', 'delivery', 'emailCount', 'printCount', 'payment', 'nameEntry', 'emailEntry', 'camera', 'receipt'];
            const currentIndex = screens.indexOf(currentScreen);
            
            if (currentIndex > 0) {
                let prevScreen = screens[currentIndex - 1];
                
                // Skip screens based on delivery method
                if (prevScreen === 'emailCount' && session.delivery !== 'email') {
                    prevScreen = screens[currentIndex - 2];
                }
                if (prevScreen === 'printCount' && session.delivery !== 'print') {
                    prevScreen = screens[currentIndex - 2];
                }
                if (prevScreen === 'emailEntry' && session.delivery !== 'email') {
                    prevScreen = 'nameEntry';
                }
                
                showScreen(prevScreen);
            }
        }

        function nextStep() {
            const screens = {
                'background': 'people',
                'people': 'delivery',
                'delivery': session.delivery === 'email' ? 'emailCount' : 'printCount',
                'emailCount': 'payment',
                'printCount': 'payment',
                'payment': 'nameEntry',
                'nameEntry': session.delivery === 'email' ? 'emailEntry' : 'camera',
                'emailEntry': 'camera',
                'camera': 'receipt'
            };
            
            if (screens[currentScreen]) {
                showScreen(screens[currentScreen]);
                
                // Setup next screen
                if (screens[currentScreen] === 'emailEntry') {
                    setupEmailInputs();
                } else if (screens[currentScreen] === 'receipt') {
                    generateReceipt();
                }
            }
        }

        // Background selection
        function loadBackgrounds() {
            loadCategoryTabs();
            loadBackgroundsForCategory(currentCategory);
        }
        
        function loadCategoryTabs() {
            const tabsContainer = document.getElementById('categoryTabs');
            tabsContainer.innerHTML = '';
            
            Object.keys(config.backgroundCategories).forEach(category => {
                const tab = document.createElement('button');
                tab.className = 'category-tab';
                tab.textContent = category;
                tab.onclick = () => selectCategory(category);
                
                if (category === currentCategory) {
                    tab.classList.add('active');
                }
                
                tabsContainer.appendChild(tab);
            });
        }
        
        function selectCategory(category) {
            currentCategory = category;
            
            // Update tab states
            document.querySelectorAll('.category-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Load backgrounds for selected category
            loadBackgroundsForCategory(category);
        }
        
        function loadBackgroundsForCategory(category) {
            const container = document.getElementById('backgroundOptions');
            container.innerHTML = '';
            
            const backgrounds = config.backgroundCategories[category];
            
            backgrounds.forEach(bg => {
                const button = document.createElement('button');
                button.className = 'touch-button';
                button.onclick = () => selectBackground(bg);
                
                button.innerHTML = `
                    <div style="width: 60px; height: 40px; border-radius: 8px; margin: 0 auto 10px; display: flex; align-items: center; justify-content: center;">${bg.preview}</div>
                    <div>${bg.name}</div>
                `;
                
                container.appendChild(button);
            });
        }

        function selectBackground(bg) {
            session.background = bg;
            
            // Update preview
            const preview = document.getElementById('preview');
            preview.style.background = 'none';
            
            if (bg.id === 18) {
                showCustomBackgroundInstructions();
            } else {
                // Scale up the SVG for the preview
                const scaledSvg = bg.preview.replace('width="60" height="40"', 'width="280" height="180"');
                preview.innerHTML = `<div style="width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; border-radius: 10px; overflow: hidden;">${scaledSvg}</div>`;
            }
            
            // Update button states
            document.querySelectorAll('#backgroundOptions .touch-button').forEach(btn => {
                btn.classList.remove('selected');
            });
            event.target.closest('.touch-button').classList.add('selected');
            
            document.getElementById('nextBtn').disabled = false;
        }

        function showCustomBackgroundInstructions() {
            const preview = document.getElementById('preview');
            preview.innerHTML = '<div style="padding: 20px; text-align: center; color: #666;">ðŸ“‹ Give this number to the photographer:<br><strong style="font-size: 2rem;">' + session.customerNumber + '</strong></div>';
        }

        // People counter
        function changePeople(delta) {
            session.people = Math.max(1, Math.min(20, session.people + delta));
            document.getElementById('peopleCount').textContent = session.people;
        }

        // Delivery selection
        function selectDelivery(method) {
            session.delivery = method;
            
            document.querySelectorAll('#delivery .touch-button').forEach(btn => {
                btn.classList.remove('selected');
            });
            
            if (method === 'email') {
                document.getElementById('emailBtn').classList.add('selected');
            } else {
                document.getElementById('printBtn').classList.add('selected');
            }
            
            document.getElementById('deliveryNext').disabled = false;
        }

        // Email counter
        function changeEmails(delta) {
            session.emailCount = Math.max(1, Math.min(config.maxEmails, session.emailCount + delta));
            document.getElementById('emailCountDisplay').textContent = session.emailCount;
        }

        // Print counter
        function changePrints(delta) {
            session.printCount = Math.max(1, Math.min(config.maxPrints, session.printCount + delta));
            document.getElementById('printCountDisplay').textContent = session.printCount;
        }

        // Payment selection
        function selectPayment(method) {
            session.payment = method;
            
            document.querySelectorAll('#payment .touch-button').forEach(btn => {
                btn.classList.remove('selected');
            });
            
            if (method === 'cash') {
                document.getElementById('cashBtn').classList.add('selected');
            } else if (method === 'card') {
                document.getElementById('cardBtn').classList.add('selected');
            } else if (method === 'check') {
                document.getElementById('checkBtn').classList.add('selected');
            }
            
            document.getElementById('paymentNext').disabled = false;
        }

        // Name entry
        document.getElementById('customerName').addEventListener('input', function() {
            session.name = this.value.trim();
            document.getElementById('nameNext').disabled = session.name.length === 0;
        });

        // Email entry
        function setupEmailInputs() {
            const container = document.getElementById('emailInputs');
            container.innerHTML = '';
            session.emails = [];
            
            for (let i = 0; i < session.emailCount; i++) {
                const input = document.createElement('input');
                input.type = 'email';
                input.className = 'email-input';
                input.placeholder = `Email ${i + 1}`;
                input.addEventListener('input', validateEmails);
                container.appendChild(input);
            }
        }

        function validateEmails() {
            const inputs = document.querySelectorAll('#emailInputs input');
            session.emails = [];
            let allValid = true;
            
            inputs.forEach(input => {
                const email = input.value.trim();
                if (email) {
                    session.emails.push(email);
                } else {
                    allValid = false;
                }
            });
            
            document.getElementById('emailNext').disabled = !allValid || session.emails.length !== session.emailCount;
        }

        // Camera
        function takePhoto() {
            session.photoTaken = true;
            const placeholder = document.getElementById('cameraPlaceholder');
            placeholder.innerHTML = '<span>ðŸ“¸ Photo Captured!<br>Looking great! ðŸ˜Š</span>';
            placeholder.style.background = '#e8f5e8';
            document.getElementById('retakeBtn').style.display = 'flex';
            document.getElementById('cameraNext').disabled = false;
        }

        function retakePhoto() {
            session.photoTaken = false;
            const placeholder = document.getElementById('cameraPlaceholder');
            placeholder.innerHTML = '<span>ðŸ“¸ Camera Preview<br>Smile! ðŸ˜Š</span>';
            placeholder.style.background = '#f0f0f0';
            document.getElementById('retakeBtn').style.display = 'none';
            document.getElementById('cameraNext').disabled = true;
        }

        // Receipt generation
        function generateReceipt() {
            const now = new Date();
            const date = now.toLocaleDateString();
            const time = now.toLocaleTimeString();
            
            // Customer copy
            document.getElementById('receiptEvent').textContent = config.eventName;
            document.getElementById('receiptName').textContent = session.name;
            document.getElementById('receiptNumber').textContent = session.customerNumber;
            document.getElementById('receiptDate').textContent = date;
            document.getElementById('receiptTime').textContent = time;
            document.getElementById('receiptPrints').textContent = session.delivery === 'print' ? session.printCount : '0';
            document.getElementById('receiptEmails').textContent = session.delivery === 'email' ? session.emailCount : '0';
            document.getElementById('receiptPayment').textContent = session.payment.toUpperCase();
            
            // Operator copy
            document.getElementById('opName').textContent = session.name;
            document.getElementById('opCustomerId').textContent = session.customerNumber;
            document.getElementById('opDelivery').textContent = session.delivery.toUpperCase();
            document.getElementById('opDate').textContent = date;
            document.getElementById('opTime').textContent = time;
            document.getElementById('opPeople').textContent = session.people;
            document.getElementById('opBackground').textContent = session.background.id;
            document.getElementById('opPrints').textContent = session.delivery === 'print' ? session.printCount : '0';
            document.getElementById('opEmailCount').textContent = session.delivery === 'email' ? session.emailCount : '0';
            document.getElementById('photoNumber').textContent = String(photoCounter).padStart(3, '0');
            
            if (session.delivery === 'email') {
                document.getElementById('opEmailList').innerHTML = session.emails.map(email => `â€¢ ${email}`).join('<br>');
            } else {
                document.getElementById('opEmailList').textContent = 'N/A';
            }
            
            photoCounter++;
        }

        function printReceipt() {
            // In a real implementation, this would send to printer
            alert('Receipt sent to printer! Please collect from the printer tray.');
        }

        function startOver() {
            // Reset session
            session = {
                background: null,
                people: 1,
                delivery: null,
                emailCount: 1,
                printCount: 1,
                payment: null,
                name: '',
                emails: [],
                customerNumber: null,
                photoTaken: false
            };
            
            // Reset UI
            document.querySelectorAll('.touch-button').forEach(btn => btn.classList.remove('selected'));
            document.querySelectorAll('.nav-button').forEach(btn => btn.disabled = false);
            document.getElementById('nextBtn').disabled = true;
            document.getElementById('deliveryNext').disabled = true;
            document.getElementById('paymentNext').disabled = true;
            document.getElementById('nameNext').disabled = true;
            document.getElementById('emailNext').disabled = true;
            document.getElementById('cameraNext').disabled = true;
            
            document.getElementById('customerName').value = '';
            document.getElementById('peopleCount').textContent = '1';
            document.getElementById('emailCountDisplay').textContent = '1';
            document.getElementById('printCountDisplay').textContent = '1';
            
            // Reset camera preview
            stopCamera();
            const placeholder = document.getElementById('cameraPlaceholder');
            if (placeholder) {
                placeholder.innerHTML = '<span>ðŸ“¸ Camera Preview<br>Smile! ðŸ˜Š</span>';
                placeholder.style.background = '#f0f0f0';
                placeholder.style.display = 'flex';
            }
            document.getElementById('retakeBtn').style.display = 'none';
            
            showScreen('welcome');
        }

        function showHelp() {
            // In a real implementation, this might call an attendant or show help
            alert('An attendant will be with you shortly! Look for someone with a "Photo Helper" badge.');
        }

        function quitSession() {
            // Reset session and return to welcome screen
            session = {
                background: null,
                people: 1,
                delivery: null,
                emailCount: 1,
                printCount: 1,
                payment: null,
                name: '',
                emails: [],
                customerNumber: null,
                photoTaken: false
            };
            
            // Reset UI
            document.querySelectorAll('.touch-button').forEach(btn => btn.classList.remove('selected'));
            document.querySelectorAll('.nav-button').forEach(btn => btn.disabled = false);
            document.getElementById('nextBtn').disabled = true;
            document.getElementById('deliveryNext').disabled = true;
            document.getElementById('paymentNext').disabled = true;
            document.getElementById('nameNext').disabled = true;
            document.getElementById('emailNext').disabled = true;
            document.getElementById('cameraNext').disabled = true;
            
            document.getElementById('customerName').value = '';
            document.getElementById('peopleCount').textContent = '1';
            document.getElementById('emailCountDisplay').textContent = '1';
            document.getElementById('printCountDisplay').textContent = '1';
            
            // Reset camera preview
            stopCamera();
            const placeholder = document.getElementById('cameraPlaceholder');
            if (placeholder) {
                placeholder.innerHTML = '<span>ðŸ“¸ Camera Preview<br>Smile! ðŸ˜Š</span>';
                placeholder.style.background = '#f0f0f0';
                placeholder.style.display = 'flex';
            }
            document.getElementById('retakeBtn').style.display = 'none';
            
            showScreen('welcome');
        }
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'992abcb662fd13f8',t:'MTc2MTE1NDM3OS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
